// قواعد أمان Firebase Storage لمشروع kuwaity-farm
// هذه القواعد تضمن أن المستخدمين يمكنهم فقط رفع الملفات إلى مساراتهم المخصصة.

rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // القاعدة الخاصة بملفات المواضيع
    // المسار: users/<uid>/topics/<topicId>/<fileName>
    match /users/{userId}/topics/{topicId}/{allPaths=**} {
      
      // شروط الكتابة (الرفع):
      // فقط المستخدم المالك (الذي يتطابق uid الخاص به مع {userId} في المسار) يمكنه الرفع.
      allow write: if request.auth != null && request.auth.uid == userId;
      
      // شروط القراءة (التحميل):
      // حاليًا، أي شخص لديه الرابط يمكنه قراءة/عرض الملف.
      // للتغيير إلى "للمستخدمين المسجلين فقط"، استبدل `if true;` بـ `if request.auth != null;`
      allow read: if true;
    }
  }
}
