// قواعد أمان Cloud Storage لمشروع kuwaity-farm
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // القاعدة الخاصة بملفات المواضيع (الصور، الفيديوهات، إلخ)
    // المسار: /users/{userId}/topics/{topicId}/{fileName}
    match /users/{userId}/topics/{topicId}/{allPaths=**} {
      // السماح بالكتابة (رفع، تحديث، حذف) فقط لمالك المجلد (نفس المستخدم).
      allow write: if request.auth != null && request.auth.uid == userId;

      // السماح بالقراءة للجميع (ملفات عامة).
      // لتقييد القراءة للمستخدمين المسجلين فقط، غيّر السطر التالي إلى:
      // allow read: if request.auth != null;
      allow read: if true;
    }

    // مثال لقاعدة أخرى: صور المستخدم الشخصية (الأفاتار)
    // المسار: /users/{userId}/avatar/{fileName}
    match /users/{userId}/avatar/{allPaths=**} {
       allow write: if request.auth != null && request.auth.uid == userId;
       allow read: if true; // أو if request.auth != null; للقراءة المقيدة
    }

    // أي مسارات أخرى غير معرّفة هنا ستكون ممنوعة افتراضيًا.
  }
}
