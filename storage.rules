// --- FILE: storage.rules ---
// هذه القواعد تهدف إلى تأمين ملفاتك على Firebase Storage.
// لتغيير قواعد القراءة من "عامة" إلى "مقيدة للمسجلين فقط"،
// استبدل `allow read: if true;` بـ `allow read: if request.auth != null;`

rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
  
    // --- قاعدة ملفات المواضيع (Topics) ---
    // المسار: users/{uid}/topics/{topicId}/{fileName}
    // تسمح هذه القاعدة للمستخدم مالك `uid` فقط برفع الملفات (الكتابة).
    // القراءة متاحة للجميع بشكل افتراضي.
    match /users/{uid}/topics/{topicId}/{fileName} {
      // القراءة عامة (يمكن لأي شخص لديه الرابط عرض الملف).
      allow read: if true;
      
      // الكتابة (الرفع) مسموحة فقط للمستخدم الذي يتطابق `uid` الخاص به
      // مع المجلد الذي يحاول الرفع إليه.
      allow write: if request.auth != null && request.auth.uid == uid;
    }
    
    // --- مثال: قاعدة صورة البروفايل (Avatar) ---
    // المسار: users/{uid}/avatar/{fileName}
    // تسمح للمستخدم برفع صورة بروفايل واحدة وتحديثها.
    match /users/{uid}/avatar/{fileName} {
       allow read: if true;
       allow write: if request.auth != null && request.auth.uid == uid;
    }
  }
}
// --- END FILE ---