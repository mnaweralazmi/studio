// قواعد أمان Firebase Storage لمشروع kuwaity-farm
// هذه القواعد تضمن أن المستخدمين يمكنهم فقط رفع الملفات إلى مجلداتهم الخاصة.
// القراءة الافتراضية عامة، مما يعني أن أي شخص لديه الرابط يمكنه عرض الملف.
// لتقييد قراءة الملفات للمستخدمين المسجلين فقط، قم بتغيير "allow read: if true;"
// إلى "allow read: if request.auth != null;".

rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // --- قاعدة خاصة بملفات المواضيع ---
    // تسمح للمستخدم المالك فقط برفع الملفات المرتبطة بمواضيعه.
    match /users/{userId}/topics/{topicId}/{allPaths=**} {
      allow read: if true; // أي شخص معه الرابط يمكنه القراءة
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // --- مثال لقاعدة صور الملف الشخصي (Avatar) ---
    // تسمح للمستخدم المالك فقط برفع وتحديث صورته الشخصية.
    match /users/{userId}/avatar/{allPaths=**} {
       allow read: if true;
       allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // قاعدة تمنع الكتابة أو القراءة في أي مسارات أخرى غير محددة أعلاه.
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
