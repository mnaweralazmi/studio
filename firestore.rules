rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Users can read their own user document, and any user can create one.
    match /users/{userId} {
      allow read, update, delete: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null;
    }

    // Allow users to read agricultural topics data.
    match /data/{topicId} {
        allow read: if true; // Accessible to all users
        allow write: if false; // Data is pre-seeded
    }

    // Rules for financial and task data, scoped per-department or feature.
    // This helper function checks if the user is the owner of the document.
    function isOwner() {
      return request.auth != null && request.auth.uid == resource.data.ownerId;
    }
    
    function isCreatingOwnContent() {
      return request.auth != null && request.resource.data.ownerId == request.auth.uid;
    }

    // Departmental Sales
    match /agriculture_sales/{saleId} { allow read, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /livestock_sales/{saleId} { allow read, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /poultry_sales/{saleId} { allow read, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /fish_sales/{saleId} { allow read, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /archive_sales/{saleId} { allow read: if isOwner(); allow create: if isCreatingOwnContent(); }

    // Departmental Expenses
    match /agriculture_expenses/{expenseId} { allow read, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /livestock_expenses/{expenseId} { allow read, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /poultry_expenses/{expenseId} { allow read, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /fish_expenses/{expenseId} { allow read, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /archive_expenses/{expenseId} { allow read: if isOwner(); allow create: if isCreatingOwnContent(); }

    // Departmental Debts
    match /agriculture_debts/{debtId} { allow read, update, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /livestock_debts/{debtId} { allow read, update, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    `poultry_debts`poultry_debts/{debtId} { allow read, update, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /fish_debts/{debtId} { allow read, update, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /archive_debts/{debtId} { allow read: if isOwner(); allow create: if isCreatingOwnContent(); }

    // Departmental Workers
    match /agriculture_workers/{workerId} { allow read, update, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /livestock_workers/{workerId} { allow read, update, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /poultry_workers/{workerId} { allow read, update, delete: if isOwner(); allow create: if isCreatingOwnContent(); }
    match /fish_workers/{workerId} { allow read, update, delete: if isOwner(); allow create: if isCreatingOwnContent(); }

    // Tasks
    match /tasks/{taskId} {
      allow read, update, delete: if isOwner();
      allow create: if isCreatingOwnContent();
    }
    match /completed_tasks/{taskId} {
       allow read: if isOwner();
       allow create: if isCreatingOwnContent();
    }
  }
}