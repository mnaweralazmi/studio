rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if user is an admin
    function isAdmin() {
      // Direct access to the admin UID list
      return request.auth.uid in ['JU2IAJu8XEeCqM33bu1wzlrA7id2'];
    }
    
    // Public read, only admin write for ads
    match /siteContent/{docId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    // Notifications are public read, only admin can create
    match /notifications/{notificationId} {
       allow read: if true;
       allow create: if isAdmin();
       allow update: if request.auth.uid != null; // Allow any logged-in user to mark as read
    }

    // Users can only access their own data
    match /users/{userId}/{documents=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Topics can be read by anyone if public, but only by the user if private.
    // Topics can be written/deleted only by their owner or an admin.
    match /users/{userId}/topics/{topicId} {
       allow read: if resource.data.isPublic == true || (request.auth != null && request.auth.uid == userId);
       allow create, update, delete: if request.auth != null && (request.auth.uid == userId || isAdmin());
    }
  }
}
